function Cube(){this.init=function(a,b,c,d,e){this.gl=a,this.id=b,this.x=c,this.y=d,this.z=e,this.vertices=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],this.setXYZ(),this.cubeVertexPositionBuffer=this.gl.createBuffer(),this.cubeVertexTextureCoordBuffer=this.gl.createBuffer(),this.cubeVertexIndexBuffer=this.gl.createBuffer()},this.generateCubo=function(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.cubeVertexPositionBuffer);var a=[this.vertices[0][0],this.vertices[0][1],this.vertices[0][2],this.vertices[1][0],this.vertices[1][1],this.vertices[1][2],this.vertices[2][0],this.vertices[2][1],this.vertices[2][2],this.vertices[3][0],this.vertices[3][1],this.vertices[3][2],this.vertices[4][0],this.vertices[4][1],this.vertices[4][2],this.vertices[5][0],this.vertices[5][1],this.vertices[5][2],this.vertices[6][0],this.vertices[6][1],this.vertices[6][2],this.vertices[7][0],this.vertices[7][1],this.vertices[7][2],this.vertices[5][0],this.vertices[5][1],this.vertices[5][2],this.vertices[3][0],this.vertices[3][1],this.vertices[3][2],this.vertices[2][0],this.vertices[2][1],this.vertices[2][2],this.vertices[6][0],this.vertices[6][1],this.vertices[6][2],this.vertices[4][0],this.vertices[4][1],this.vertices[4][2],this.vertices[7][0],this.vertices[7][1],this.vertices[7][2],this.vertices[1][0],this.vertices[1][1],this.vertices[1][2],this.vertices[0][0],this.vertices[0][1],this.vertices[0][2],this.vertices[7][0],this.vertices[7][1],this.vertices[7][2],this.vertices[6][0],this.vertices[6][1],this.vertices[6][2],this.vertices[2][0],this.vertices[2][1],this.vertices[2][2],this.vertices[1][0],this.vertices[1][1],this.vertices[1][2],this.vertices[4][0],this.vertices[4][1],this.vertices[4][2],this.vertices[0][0],this.vertices[0][1],this.vertices[0][2],this.vertices[3][0],this.vertices[3][1],this.vertices[3][2],this.vertices[5][0],this.vertices[5][1],this.vertices[5][2]];this.centro=[this.vertices[0][0]+this.vertices[1][0]+this.vertices[2][0]+this.vertices[3][0]+this.vertices[4][0]+this.vertices[5][0]+this.vertices[6][0]+this.vertices[7][0],this.vertices[0][1]+this.vertices[1][1]+this.vertices[2][1]+this.vertices[3][1]+this.vertices[4][1]+this.vertices[5][1]+this.vertices[6][1]+this.vertices[7][1],this.vertices[0][2]+this.vertices[1][2]+this.vertices[2][2]+this.vertices[3][2]+this.vertices[4][2]+this.vertices[5][2]+this.vertices[6][2]+this.vertices[7][2]],this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(a),this.gl.STATIC_DRAW),this.cubeVertexPositionBuffer.itemSize=3,this.cubeVertexPositionBuffer.numItems=24,this.cubeVertexTextureCoordBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.cubeVertexTextureCoordBuffer);var b=[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1];this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(b),this.gl.STATIC_DRAW),this.cubeVertexTextureCoordBuffer.itemSize=2,this.cubeVertexTextureCoordBuffer.numItems=24,this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.cubeVertexIndexBuffer);var c=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(c),this.gl.STATIC_DRAW),mvPushMatrix(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.cubeVertexPositionBuffer),this.gl.vertexAttribPointer(shaderProgram.vertexPositionAttribute,3,this.gl.FLOAT,!1,0,0),setMatrixUniforms(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.cubeVertexTextureCoordBuffer),this.gl.vertexAttribPointer(shaderProgram.textureCoordAttribute,this.cubeVertexTextureCoordBuffer.itemSize,this.gl.FLOAT,!1,0,0),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,textureBlue),this.gl.uniform1i(shaderProgram.samplerUniform,0),this.gl.drawElements(this.gl.TRIANGLE_STRIP,6,this.gl.UNSIGNED_SHORT,0),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,textureYellow),this.gl.uniform1i(shaderProgram.samplerUniform,1),this.gl.drawElements(this.gl.TRIANGLE_STRIP,6,this.gl.UNSIGNED_SHORT,12),this.gl.activeTexture(this.gl.TEXTURE2),this.gl.bindTexture(this.gl.TEXTURE_2D,textureWhite),this.gl.uniform1i(shaderProgram.samplerUniform,2),this.gl.drawElements(this.gl.TRIANGLE_STRIP,6,this.gl.UNSIGNED_SHORT,24),this.gl.activeTexture(this.gl.TEXTURE3),this.gl.bindTexture(this.gl.TEXTURE_2D,textureMagent),this.gl.uniform1i(shaderProgram.samplerUniform,3),this.gl.drawElements(this.gl.TRIANGLE_STRIP,6,this.gl.UNSIGNED_SHORT,36),this.gl.activeTexture(this.gl.TEXTURE4),this.gl.bindTexture(this.gl.TEXTURE_2D,textureGreen),this.gl.uniform1i(shaderProgram.samplerUniform,4),this.gl.drawElements(this.gl.TRIANGLE_STRIP,6,this.gl.UNSIGNED_SHORT,48),this.gl.activeTexture(this.gl.TEXTURE5),this.gl.bindTexture(this.gl.TEXTURE_2D,textureRed),this.gl.uniform1i(shaderProgram.samplerUniform,5),this.gl.drawElements(this.gl.TRIANGLE_STRIP,6,this.gl.UNSIGNED_SHORT,60),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.cubeVertexIndexBuffer),mvPopMatrix()},this.rotateX=function(a,b){var c=0,d=0,e=0,f=a[0]-c,g=a[1]-d,h=a[2]-e,i=[[1,0,0],[0,Math.cos(degToRad(b)),Math.sin(degToRad(b))],[0,-Math.sin(degToRad(b)),Math.cos(degToRad(b))]],j=i[0][0]*f+i[0][1]*g+i[0][2]*h+c,k=i[1][0]*f+i[1][1]*g+i[1][2]*h+d,l=i[2][0]*f+i[2][1]*g+i[2][2]*h+e;return a[0]=j,a[1]=k,a[2]=l,a},this.rotateY=function(a,b){var c=0,d=0,e=0,f=a[0]-c,g=a[1]-d,h=a[2]-e,i=[[Math.cos(degToRad(b)),0,Math.sin(degToRad(b))],[0,1,0],[-Math.sin(degToRad(b)),0,Math.cos(degToRad(b))]],j=i[0][0]*f+i[0][1]*g+i[0][2]*h+c,k=i[1][0]*f+i[1][1]*g+i[1][2]*h+d,l=i[2][0]*f+i[2][1]*g+i[2][2]*h+e;return a[0]=j,a[1]=k,a[2]=l,a},this.rotateZ=function(a,b){var c=0,d=0,e=0,f=a[0]-c,g=a[1]-d,h=a[2]-e,i=[[Math.cos(degToRad(b)),-Math.sin(degToRad(b)),0],[Math.sin(degToRad(b)),Math.cos(degToRad(b)),0],[0,0,1],[0,0,0]],j=i[0][0]*f+i[0][1]*g+i[0][2]*h+c,k=i[1][0]*f+i[1][1]*g+i[1][2]*h+d,l=i[2][0]*f+i[2][1]*g+i[2][2]*h+e;return a[0]=j,a[1]=k,a[2]=l,a},this.rotateCubeX=function(a){var b=this;b.vertices.map(function(c,d){b.vertices[d]=b.rotateX(c,a)})},this.rotateCubeY=function(a){var b=this;b.vertices.map(function(c,d){b.vertices[d]=b.rotateY(c,a)})},this.rotateCubeZ=function(a){var b=this;b.vertices.map(function(c,d){b.vertices[d]=b.rotateZ(c,a)})},this.setXYZ=function(){this.vertices[0][0]=-1+this.x,this.vertices[0][1]=-1+this.y,this.vertices[0][2]=1+this.z,this.vertices[1][0]=1+this.x,this.vertices[1][1]=-1+this.y,this.vertices[1][2]=1+this.z,this.vertices[2][0]=1+this.x,this.vertices[2][1]=1+this.y,this.vertices[2][2]=1+this.z,this.vertices[3][0]=-1+this.x,this.vertices[3][1]=1+this.y,this.vertices[3][2]=1+this.z,this.vertices[4][0]=-1+this.x,this.vertices[4][1]=-1+this.y,this.vertices[4][2]=-1+this.z,this.vertices[5][0]=-1+this.x,this.vertices[5][1]=1+this.y,this.vertices[5][2]=-1+this.z,this.vertices[6][0]=1+this.x,this.vertices[6][1]=1+this.y,this.vertices[6][2]=-1+this.z,this.vertices[7][0]=1+this.x,this.vertices[7][1]=-1+this.y,this.vertices[7][2]=-1+this.z}}function initGL(a){try{for(gl=a.getContext("experimental-webgl"),resizeCanvas(),i=0;i<cubeArray.length;i++)cubeArray[i]=new Cube}catch(b){}gl||alert("Oh man!...Could not initialise WebGL. This is so sad! :(")}function getShader(a,b,c){var d;if("fs"==c)d=a.createShader(a.FRAGMENT_SHADER);else{if("vs"!=c)return null;d=a.createShader(a.VERTEX_SHADER)}return a.shaderSource(d,b),a.compileShader(d),a.getShaderParameter(d,a.COMPILE_STATUS)?d:(alert(a.getShaderInfoLog(d)),null)}function initShaders(){var a=getShader(gl,theShaderFs,"fs"),b=getShader(gl,theShaderVs,"vs");shaderProgram=gl.createProgram(),gl.attachShader(shaderProgram,b),gl.attachShader(shaderProgram,a),gl.linkProgram(shaderProgram),gl.getProgramParameter(shaderProgram,gl.LINK_STATUS)||alert("Could not initialise shaders"),gl.useProgram(shaderProgram),shaderProgram.vertexPositionAttribute=gl.getAttribLocation(shaderProgram,"aVertexPosition"),gl.enableVertexAttribArray(shaderProgram.vertexPositionAttribute),shaderProgram.textureCoordAttribute=gl.getAttribLocation(shaderProgram,"aTextureCoord"),gl.enableVertexAttribArray(shaderProgram.textureCoordAttribute),shaderProgram.pMatrixUniform=gl.getUniformLocation(shaderProgram,"uPMatrix"),shaderProgram.mvMatrixUniform=gl.getUniformLocation(shaderProgram,"uMVMatrix"),shaderProgram.samplerUniform=gl.getUniformLocation(shaderProgram,"uSampler")}function mvPushMatrix(){var a=mat4.create();mat4.set(mvMatrix,a),mvMatrixStack.push(a)}function mvPopMatrix(){if(0==mvMatrixStack.length)throw"Invalid popMatrix!";mvMatrix=mvMatrixStack.pop()}function setMatrixUniforms(){gl.uniformMatrix4fv(shaderProgram.pMatrixUniform,!1,pMatrix),gl.uniformMatrix4fv(shaderProgram.mvMatrixUniform,!1,mvMatrix)}function degToRad(a){return a*Math.PI/180}function initCubes(){cubeArray[0].init(gl,1,-2,2,2),cubeArray[1].init(gl,2,0,2,2),cubeArray[2].init(gl,3,2,2,2),cubeArray[3].init(gl,4,-2,0,2),cubeArray[4].init(gl,5,0,0,2),cubeArray[5].init(gl,6,2,0,2),cubeArray[6].init(gl,7,-2,-2,2),cubeArray[7].init(gl,8,0,-2,2),cubeArray[8].init(gl,9,2,-2,2),cubeArray[9].init(gl,10,-2,2,0),cubeArray[10].init(gl,11,0,2,0),cubeArray[11].init(gl,12,2,2,0),cubeArray[12].init(gl,13,-2,0,0),cubeArray[13].init(gl,14,2,0,0),cubeArray[14].init(gl,15,-2,-2,0),cubeArray[15].init(gl,16,0,-2,0),cubeArray[16].init(gl,17,2,-2,0),cubeArray[17].init(gl,18,-2,2,-2),cubeArray[18].init(gl,19,0,2,-2),cubeArray[19].init(gl,20,2,2,-2),cubeArray[20].init(gl,21,-2,0,-2),cubeArray[21].init(gl,22,0,0,-2),cubeArray[22].init(gl,23,2,0,-2),cubeArray[23].init(gl,24,-2,-2,-2),cubeArray[24].init(gl,25,0,-2,-2),cubeArray[25].init(gl,26,2,-2,-2)}function drawScene(){gl.viewport(0,0,gl.viewportWidth,gl.viewportHeight),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),mat4.perspective(45,gl.viewportWidth/gl.viewportHeight,.1,100,pMatrix),mat4.identity(mvMatrix),mat4.translate(mvMatrix,[0,0,-16]),mat4.rotate(mvMatrix,degToRad(xRot),[1,0,0]),mat4.rotate(mvMatrix,degToRad(yRot),[0,1,0]),mat4.multiply(mvMatrix,rotationMatrix)}function resizeCanvas(){var a=document.getElementById("rubiks"),b=a.clientWidth,c=a.clientHeight;(a.width!=b||a.height!=c)&&(a.width=b,a.height=c,gl.viewportWidth=a.width,gl.viewportHeight=a.height)}function animate(){var a=(new Date).getTime();if(0!=lastTime){var b=a-lastTime;xRot+=xSpeed*b/1e3,yRot+=ySpeed*b/1e3,gameStarted||(xRot+=.5,yRot+=.5),cubeArray.map(function(a){a.generateCubo()});var c=movesArray.shift();"function"==typeof c&&c(),checkIfGameEnded()}lastTime=a}function handleKeys(){currentlyPressedKeys[37]&&(yRot-=5),currentlyPressedKeys[39]&&(yRot+=5),currentlyPressedKeys[38]&&(xRot-=5),currentlyPressedKeys[40]&&(xRot+=5)}function scheduleMoveAnimationEvents(a){for(i=1;10>i;i++)movesArray.push(a)}function handleKeyDown(a){if(gameStarted){currentlyPressedKeys[a.keyCode]=!0;var b=String.fromCharCode(a.keyCode);switch("C"==b&&(xRot=0,yRot=0,xSpeed=0,ySpeed=0),b){case"Q":scheduleMoveAnimationEvents(new eventOnZaxis(16,10));break;case"W":scheduleMoveAnimationEvents(new eventOnZaxis(0,10));break;case"E":scheduleMoveAnimationEvents(new eventOnZaxis(-16,10));break;case"A":scheduleMoveAnimationEvents(new eventOnZaxis(16,-10));break;case"S":scheduleMoveAnimationEvents(new eventOnZaxis(0,-10));break;case"D":scheduleMoveAnimationEvents(new eventOnZaxis(-16,-10));break;case"R":scheduleMoveAnimationEvents(new eventOnXaxis(16,10));break;case"T":scheduleMoveAnimationEvents(new eventOnXaxis(0,10));break;case"Y":scheduleMoveAnimationEvents(new eventOnXaxis(-16,10));break;case"F":scheduleMoveAnimationEvents(new eventOnXaxis(16,-10));break;case"G":scheduleMoveAnimationEvents(new eventOnXaxis(0,-10));break;case"H":scheduleMoveAnimationEvents(new eventOnXaxis(-16,-10));break;case"U":scheduleMoveAnimationEvents(new eventOnYaxis(16,10));break;case"I":scheduleMoveAnimationEvents(new eventOnYaxis(0,10));break;case"O":scheduleMoveAnimationEvents(new eventOnYaxis(-16,10));break;case"J":scheduleMoveAnimationEvents(new eventOnYaxis(16,-10));break;case"K":scheduleMoveAnimationEvents(new eventOnYaxis(0,-10));break;case"L":scheduleMoveAnimationEvents(new eventOnYaxis(-16,-10))}}}function handleKeyUp(a){currentlyPressedKeys[a.keyCode]=!1}function handleMouseDown(a){mouseDown=!0,lastMouseX=a.clientX,lastMouseY=a.clientY}function handleMouseUp(){mouseDown=!1}function handleMouseMove(a){if(mouseDown){var b=a.clientX,c=a.clientY;xRot=0,yRot=0,xSpeed=0,ySpeed=0;var d=mat4.create();mat4.identity(d);var e=b-lastMouseX;mat4.rotate(d,degToRad(e/7),[0,1,0]);var f=c-lastMouseY;mat4.rotate(d,degToRad(f/7),[1,0,0]),mat4.multiply(d,rotationMatrix,rotationMatrix),lastMouseX=b,lastMouseY=c}}function handleTouchMove(a){a.preventDefault();var b=a.targetTouches[0].clientX,c=a.targetTouches[0].clientY;1==a.targetTouches.length||2==a.targetTouches.length&&(Math.abs(b-lastMouseX)>Math.abs(c-lastMouseY)?b>lastMouseX?yRot+=2:yRot-=2:c>lastMouseY?xRot+=2:xRot-=2,lastMouseX=b,lastMouseY=c)}function handleLoadedTexture(a){gl.bindTexture(gl.TEXTURE_2D,a),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!0),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,a.image),gl.generateMipmap(gl.TEXTURE_2D),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_LINEAR),gl.bindTexture(gl.TEXTURE_2D,null),loadedTextures==numTextures&&tick()}function initTextures(){var a=["/resources/img/blue.png","/resources/img/yellow.png","/resources/img/white.png","/resources/img/orange.png","/resources/img/green.png","/resources/img/red.png"];textureBlue=gl.createTexture(),textureBlue.image=new Image,textureBlue.image.onload=function(){loadedTextures++,handleLoadedTexture(textureBlue)},textureBlue.image.src=a[0],textureYellow=gl.createTexture(),textureYellow.image=new Image,textureYellow.image.onload=function(){loadedTextures++,handleLoadedTexture(textureYellow)},textureYellow.image.src=a[1],textureWhite=gl.createTexture(),textureWhite.image=new Image,textureWhite.image.onload=function(){loadedTextures++,handleLoadedTexture(textureWhite)},textureWhite.image.src=a[2],textureMagent=gl.createTexture(),textureMagent.image=new Image,textureMagent.image.onload=function(){loadedTextures++,handleLoadedTexture(textureMagent)},textureMagent.image.src=a[3],textureGreen=gl.createTexture(),textureGreen.image=new Image,textureGreen.image.onload=function(){loadedTextures++,handleLoadedTexture(textureGreen)},textureGreen.image.src=a[4],textureRed=gl.createTexture(),textureRed.image=new Image,textureRed.image.onload=function(){loadedTextures++,handleLoadedTexture(textureRed)},textureRed.image.src=a[5]}function cubeRandom(){var a=[16,-16,0],b=[1,-1],c=[eventOnXaxis,eventOnYaxis,eventOnZaxis];for(xRot=yRot=45,i=0;i<Math.floor(200*Math.random()+1);i++){var d=a[Math.floor(2*Math.random()+1)],e=b[Math.floor(1*Math.random()+1)],f=c[Math.floor(2*Math.random()+1)](d,10*e);for(i=1;10>i;i++)movesArray.push(f)}}function tick(){requestAnimFrame(tick),handleKeys(),drawScene(),animate()}function checkIfGameEnded(){if(gameStarted&&0==movesArray.length){var a=[];for(i=0;i<cubeArray.length;i++){var b=JSON.parse(JSON.stringify(cubeArray[i].vertices));for(z=0;z<b.length;z++){var c=b[z];for(w=0;w<c.length;w++)c[w]=Math.round(c[w])}a.push(b)}JSON.stringify(a)==localStorage.cubeArrayInitSate&&(alert("Good Job! :)"),gameStarted=!1,localStorage.removeItem("cubeSavedState"))}}function initPageEvents(){document.getElementById("btNewGame").onclick=function(){movesArray=[],initCubes();var a=[];for(i=0;i<cubeArray.length;i++)a.push(JSON.parse(JSON.stringify(cubeArray[i].vertices)));localStorage.cubeArrayInitSate=JSON.stringify(a),cubeRandom(),gameStarted=!0},document.getElementById("btSaveGame").onclick=function(){if(gameStarted&&0==movesArray.length){var a=[];for(i=0;i<cubeArray.length;i++)a.push(JSON.parse(JSON.stringify(cubeArray[i].vertices)));localStorage.cubeSavedState=JSON.stringify(a)}},document.getElementById("btLoadGame").onclick=function(){if(void 0!=localStorage.cubeSavedState){var a=JSON.parse(localStorage.cubeSavedState);if(gameStarted&&"undefined"!=typeof a&&26==a.length&&0==movesArray.length)for(i=0;i<cubeArray.length;i++)cubeArray[i].vertices=JSON.parse(JSON.stringify(a[i]))}}}function webGLStart(){var a=document.getElementById("rubiks");initGL(a),initPageEvents(),initShaders(),initTextures(),initCubes(),gl.clearColor(.1,.1,.1,1),gl.enable(gl.DEPTH_TEST),a.addEventListener("touchmove",handleTouchMove),a.onmousedown=handleMouseDown,document.onmouseup=handleMouseUp,document.onkeydown=handleKeyDown,document.onkeyup=handleKeyUp,window.addEventListener("resize",resizeCanvas)}var gl,theShaderFs=" precision mediump float;  varying vec2 vTextureCoord;  uniform sampler2D uSampler;  void main(void) {    gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));  } ",theShaderVs=" attribute vec3 aVertexPosition;  attribute vec2 aTextureCoord;  uniform mat4 uMVMatrix;  uniform mat4 uPMatrix;  varying vec2 vTextureCoord;  void main(void) {     gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);     vTextureCoord = aTextureCoord;  }",lastTime=0,cubeArray=new Array(26),shaderProgram,mvMatrix=mat4.create(),pMatrix=mat4.create(),mvMatrixStack=[],xRot=0,xSpeed=0,yRot=0,ySpeed=0,rotationMatrix=mat4.create(),mouseDown=!1,lastMouseX=null,lastMouseY=null,numTextures=6,loadedTextures=0,movesArray=[],currentlyPressedKeys={},gameStarted=!1;mat4.identity(rotationMatrix);var eventOnXaxis=function(a,b){function c(){cubeArray.map(function(c){Math.round(c.centro[0])==a&&c.rotateCubeX(b)})}return c},eventOnYaxis=function(a,b){function c(){cubeArray.map(function(c){Math.round(c.centro[1])==a&&c.rotateCubeY(b)})}return c},eventOnZaxis=function(a,b){function c(){cubeArray.map(function(c){Math.round(c.centro[2])==a&&c.rotateCubeZ(b)})}return c};